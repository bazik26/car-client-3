<!-- Hero Section -->
<section class="hero" id="hero">
  <div class="container">
    <div class="hero__content">
      <div class="hero__badge">
        <i class="fas fa-rocket"></i>
        <span>Премиум автоподбор из Европы</span>
      </div>
      
      <h1 class="hero__title">
        <span class="hero__title-main">Найдем вашу</span>
        <span class="hero__title-accent">идеальную машину</span>
        <span class="hero__title-sub">за 14 дней</span>
      </h1>
      
      <p class="hero__description">
        Эксклюзивный подбор автомобилей из Германии, Франции и Италии. 
        Полная проверка истории, техническая инспекция и гарантия качества. 
        <strong>Экономия до 30%</strong> по сравнению с российским рынком.
      </p>
      
      <div class="hero__actions">
        <a class="btn btn--primary" routerLink="/catalog">
          <i class="fas fa-search"></i>
          Найти авто мечты
        </a>
        <a class="btn btn--secondary" routerLink="/contacts">
          <i class="fas fa-calculator"></i>
          Рассчитать стоимость
        </a>
      </div>
      
      <div class="hero__stats">
        <a class="stat-card stat-card--car" *ngIf="highlighted()[0] as car1" [routerLink]="['/cars', car1.id]" target="_blank">
          <div class="stat-car-image">
            <img [ngSrc]="getCarImageUrl(car1)" [alt]="car1.brand + ' ' + car1.model" width="200" height="120" class="stat-car-img">
          </div>
          <div class="stat-number">{{ formatPrice(getDiscountedPrice(car1.price, 0)) }}</div>
          <div class="stat-label">{{ car1.brand }} {{ car1.model }}</div>
          <div class="stat-detail">{{ car1.engine }}л • {{ car1.gearbox }} • {{ car1.drive }}</div>
        </a>
        <a class="stat-card stat-card--car" *ngIf="highlighted()[1] as car2" [routerLink]="['/cars', car2.id]" target="_blank">
          <div class="stat-car-image">
            <img [ngSrc]="getCarImageUrl(car2)" [alt]="car2.brand + ' ' + car2.model" width="200" height="120" class="stat-car-img">
            <div class="stat-badge stat-badge--discount">Скидка 15%</div>
          </div>
          <div class="stat-number">{{ formatPrice(getDiscountedPrice(car2.price, 15)) }}</div>
          <div class="stat-label">{{ car2.brand }} {{ car2.model }}</div>
          <div class="stat-detail">{{ car2.engine }}л • {{ car2.gearbox }} • {{ car2.drive }}</div>
        </a>
        <a class="stat-card stat-card--car" *ngIf="highlighted()[2] as car3" [routerLink]="['/cars', car3.id]" target="_blank">
          <div class="stat-car-image">
            <img [ngSrc]="getCarImageUrl(car3)" [alt]="car3.brand + ' ' + car3.model" width="200" height="120" class="stat-car-img">
            <div class="stat-badge stat-badge--new">Новинка</div>
          </div>
          <div class="stat-number">{{ formatPrice(getDiscountedPrice(car3.price, 0)) }}</div>
          <div class="stat-label">{{ car3.brand }} {{ car3.model }}</div>
          <div class="stat-detail">{{ car3.engine }}л • {{ car3.gearbox }} • {{ car3.drive }}</div>
        </a>
      </div>
    </div>
    
    <div class="hero__visual">
      <div class="hero__car-showcase">
        <div class="hero__car-card hero__car-card--featured" *ngIf="bestOffer()">
          <div class="car-image">
            <img [ngSrc]="getCarImageUrl(bestOffer())" [alt]="bestOffer()?.brand + ' ' + bestOffer()?.model" width="400" height="300" class="car-img">
            <div class="car-badge">Хит продаж</div>
          </div>
          <div class="car-info">
            <h3>{{ bestOffer()?.brand }} {{ bestOffer()?.model }} {{ bestOffer()?.year }}</h3>
            <p class="car-price">{{ formatPrice(getDiscountedPrice(bestOffer()?.price, 0)) }}</p>
            <div class="car-specs">
              <span>{{ bestOffer()?.engine }}л • {{ bestOffer()?.gearbox }} • {{ bestOffer()?.drive }}</span>
            </div>
          </div>
        </div>
        
        <div class="hero__car-card hero__car-card--secondary" *ngIf="popular()[0]">
          <div class="car-image">
            <img [ngSrc]="getCarImageUrl(popular()[0])" [alt]="popular()[0]?.brand + ' ' + popular()[0]?.model" width="400" height="300" class="car-img">
            <div class="car-badge car-badge--sale">Скидка 15%</div>
          </div>
          <div class="car-info">
            <h3>{{ popular()[0]?.brand }} {{ popular()[0]?.model }} {{ popular()[0]?.year }}</h3>
            <p class="car-price">{{ formatPrice(getDiscountedPrice(popular()[0]?.price, 15)) }}</p>
            <div class="car-specs">
              <span>{{ popular()[0]?.engine }}л • {{ popular()[0]?.gearbox }} • {{ popular()[0]?.drive }}</span>
            </div>
          </div>
        </div>
        
        <div class="hero__car-card hero__car-card--tertiary" *ngIf="popular()[1]">
          <div class="car-image">
            <img [ngSrc]="getCarImageUrl(popular()[1])" [alt]="popular()[1]?.brand + ' ' + popular()[1]?.model" width="400" height="300" class="car-img">
            <div class="car-badge car-badge--new">Новинка</div>
          </div>
          <div class="car-info">
            <h3>{{ popular()[1]?.brand }} {{ popular()[1]?.model }} {{ popular()[1]?.year }}</h3>
            <p class="car-price">{{ formatPrice(getDiscountedPrice(popular()[1]?.price, 0)) }}</p>
            <div class="car-specs">
              <span>{{ popular()[1]?.engine }}л • {{ popular()[1]?.gearbox }} • {{ popular()[1]?.drive }}</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="hero__features">
        <div class="feature-card">
          <div class="feature-icon">
            <i class="fas fa-shield-alt"></i>
          </div>
          <div class="feature-content">
            <h4>Полная проверка</h4>
            <p>118 критериев по базам ЕС</p>
          </div>
        </div>
        <div class="feature-card">
          <div class="feature-icon">
            <i class="fas fa-euro-sign"></i>
          </div>
          <div class="feature-content">
            <h4>Экономия до 30%</h4>
            <p>Прямые поставки без переплат</p>
          </div>
        </div>
        <div class="feature-card">
          <div class="feature-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="feature-content">
            <h4>Быстрая доставка</h4>
            <p>От 7 до 14 дней до Москвы</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Best Offer Section -->
<section class="best-offer" *ngIf="bestOffer() || !isLoading()">
  <div class="container">
    <div class="best-offer__header">
      <div class="best-offer__badge">
        <i class="fas fa-star"></i>
        <span>Лучшее предложение недели</span>
      </div>
      <h2 class="best-offer__title">Найдена идеальная машина для вас</h2>
    </div>
    
    <div class="best-offer__content" *ngIf="bestOffer(); else fallbackOffer">
      <div class="best-offer__car">
        <div class="car-image-large">
          <img [ngSrc]="getImageSrc(bestOffer())" [alt]="bestOffer()?.brand + ' ' + bestOffer()?.model" width="800" height="500" class="car-img-large" (error)="onImageError(bestOffer()?.id)" [ngClass]="{'car-img-large--error': imageError().has(bestOffer()?.id)}">
          <div class="car-badge-large">Лучшая цена</div>
        </div>
        <div class="car-details">
          <h3 class="car-title">{{ bestOffer()?.brand }} {{ bestOffer()?.model }} {{ bestOffer()?.year }}</h3>
          <div class="car-price-large">{{ formatPrice(getDiscountedPrice(bestOffer()?.price, 0)) }}</div>
          <div class="car-specs-large">
            <div class="spec-item">
              <i class="fas fa-calendar"></i>
              <span>{{ bestOffer()?.year }} год</span>
            </div>
            <div class="spec-item">
              <i class="fas fa-tachometer-alt"></i>
              <span>{{ bestOffer()?.mileage }} км</span>
            </div>
            <div class="spec-item">
              <i class="fas fa-cog"></i>
              <span>{{ bestOffer()?.engine }}л</span>
            </div>
            <div class="spec-item">
              <i class="fas fa-gas-pump"></i>
              <span>{{ bestOffer()?.fuel }}</span>
            </div>
          </div>
          <div class="car-features">
            <span class="feature-tag">{{ bestOffer()?.drive }}</span>
            <span class="feature-tag">{{ bestOffer()?.gearbox }}</span>
            <span class="feature-tag" *ngIf="bestOffer()?.isAccident === false">Без ДТП</span>
          </div>
        </div>
      </div>
      <div class="best-offer__actions">
        <a class="btn btn--primary btn--large" [routerLink]="['/cars', bestOffer()?.id]" target="_blank">
          <i class="fas fa-eye"></i>
          Подробнее о машине
        </a>
        <a class="btn btn--secondary btn--large" routerLink="/catalog">
          <i class="fas fa-search"></i>
          Смотреть все авто
        </a>
      </div>
    </div>
    
    <ng-template #fallbackOffer>
      <div class="best-offer__content">
        <div class="best-offer__car">
        <div class="car-image-large">
          <img [ngSrc]="getImageSrc(fallbackCar())" [alt]="fallbackCar()?.brand + ' ' + fallbackCar()?.model" width="800" height="500" class="car-img-large" (error)="onImageError(fallbackCar()?.id)" [ngClass]="{'car-img-large--error': imageError().has(fallbackCar()?.id)}">
          <div class="car-badge-large">Популярный выбор</div>
        </div>
          <div class="car-details">
            <h3 class="car-title">{{ fallbackCar()?.brand }} {{ fallbackCar()?.model }} {{ fallbackCar()?.year }}</h3>
            <div class="car-price-large">{{ formatPrice(getDiscountedPrice(fallbackCar()?.price, 0)) }}</div>
            <div class="car-specs-large">
              <div class="spec-item">
                <i class="fas fa-calendar"></i>
                <span>{{ fallbackCar()?.year }} год</span>
              </div>
              <div class="spec-item">
                <i class="fas fa-tachometer-alt"></i>
                <span>{{ fallbackCar()?.mileage }} км</span>
              </div>
              <div class="spec-item">
                <i class="fas fa-cog"></i>
                <span>{{ fallbackCar()?.engine }}л</span>
              </div>
              <div class="spec-item">
                <i class="fas fa-gas-pump"></i>
                <span>{{ fallbackCar()?.fuel }}</span>
              </div>
            </div>
            <div class="car-features">
              <span class="feature-tag">{{ fallbackCar()?.drive }}</span>
              <span class="feature-tag">{{ fallbackCar()?.gearbox }}</span>
              <span class="feature-tag" *ngIf="!fallbackCar()?.isAccident">Без ДТП</span>
            </div>
          </div>
        </div>
        <div class="best-offer__actions">
          <button class="btn btn--primary btn--large" routerLink="/catalog">
            <i class="fas fa-search"></i>
            Найти похожие авто
          </button>
          <button class="btn btn--secondary btn--large" routerLink="/contacts">
            <i class="fas fa-phone"></i>
            Получить консультацию
          </button>
        </div>
      </div>
    </ng-template>
  </div>
</section>

<!-- Showcase Section -->
<section class="showcase" id="collections">
  <div class="container">
    <div class="showcase__header">
      <div class="showcase__title-section">
        <h2 class="showcase__title">Подборки, которые мы рекомендуем</h2>
        <p class="showcase__subtitle">
          Выберите сценарий — мы подсветим автомобили, подходящие под ваши задачи.
          Подбор формируется автоматически в реальном времени.
        </p>
      </div>
      <a class="btn btn--secondary" routerLink="/catalog">Открыть весь каталог</a>
    </div>

    <div class="showcase__filters">
      <button
        *ngFor="let filter of showcaseFilters; let i = index"
        type="button"
        class="filter-chip"
        [class.active]="selectedFilter()?.id === filter.id"
        (click)="selectFilter(filter)">
        <span class="filter-chip__title">{{ filter.title }}</span>
        <small class="filter-chip__subtitle">{{ filter.subtitle }}</small>
      </button>
    </div>

    <div class="showcase__cars" *ngIf="!isLoading() && filteredCars().length > 0; else loadingOrEmpty">
      <app-car-card 
        *ngFor="let car of filteredCars(); let i = index"
        [car]="car"
        class="car-card-wrapper"></app-car-card>
    </div>
    
    <ng-template #loadingOrEmpty>
      <div class="loading" *ngIf="isLoading(); else emptyState">
        <div class="skeleton" *ngFor="let _ of [].constructor(6); let i = index"></div>
      </div>
      <ng-template #emptyState>
        <div class="empty-state">
          <div class="empty-state__content">
            <i class="fas fa-car"></i>
            <h3>Автомобили не найдены</h3>
            <p>Попробуйте изменить фильтры или загрузить каталог заново</p>
            <button class="btn btn--primary" (click)="selectFilter(showcaseFilters[0])">
              <i class="fas fa-refresh"></i>
              Обновить
            </button>
          </div>
        </div>
      </ng-template>
    </ng-template>
  </div>
</section>

<!-- Why Us Section -->
<section class="why-us" id="why-us">
  <div class="container">
    <div class="why-us__header">
      <h2 class="why-us__title">Почему клиенты доверяют АвтоЗнатоки</h2>
      <p class="why-us__subtitle">
        Мы соединяем классический подход к покупке авто и современные цифровые инструменты, 
        чтобы сделать путь к новой машине понятным и безопасным.
      </p>
    </div>
    
    <div class="why-us__grid">
      <div class="why-us__feature">
        <div class="feature-icon-large">
          <i class="fas fa-shield-alt"></i>
        </div>
        <h3>Финансовая прозрачность</h3>
        <p>Фиксируем стоимость в договоре, все платежи проходят официально. Никаких скрытых комиссий.</p>
        <div class="feature-stats">
          <div class="stat">
            <span class="stat-number">0%</span>
            <span class="stat-label">скрытых комиссий</span>
          </div>
        </div>
      </div>
      
      <div class="why-us__feature">
        <div class="feature-icon-large">
          <i class="fas fa-clipboard-check"></i>
        </div>
        <h3>Экспертная инспекция</h3>
        <p>Инженеры с опытом работы в дилерских центрах составляют техническое заключение.</p>
        <div class="feature-stats">
          <div class="stat">
            <span class="stat-number">200+</span>
            <span class="stat-label">пунктов проверки</span>
          </div>
        </div>
      </div>
      
      <div class="why-us__feature">
        <div class="feature-icon-large">
          <i class="fas fa-headset"></i>
        </div>
        <h3>Люди и сервис</h3>
        <p>Персональный менеджер на связи 24/7, помощь с trade-in и кредитом партнёров.</p>
        <div class="feature-stats">
          <div class="stat">
            <span class="stat-number">24/7</span>
            <span class="stat-label">поддержка</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Popular Cars Section -->
<section class="popular">
  <div class="container">
    <div class="popular__header">
      <h2 class="popular__title">Живой каталог</h2>
      <p class="popular__subtitle">
        Алгоритм собирает автомобили из базы, проверяет актуальность и показывает только то,
        что доступно прямо сейчас.
      </p>
    </div>
    
    <div class="popular__cars">
      <app-car-card 
        *ngFor="let car of popular(); let i = index"
        [car]="car"
        class="car-card-wrapper"></app-car-card>
    </div>
  </div>
</section>

<!-- Stories Section -->
<section class="stories" *ngIf="soldRecently().length">
  <div class="container">
    <div class="stories__header">
      <h2 class="stories__title">Свежие истории клиентов</h2>
      <p class="stories__subtitle">
        Короткие заметки о том, как проходит путь от запроса до выдачи ключей. 
        Каждая история — живое подтверждение процесса.
      </p>
    </div>
    
    <div class="stories__grid">
      <article class="story-card" *ngFor="let car of soldRecently(); let i = index">
        <div class="story-card__image">
          <img [ngSrc]="getCarImageUrl(car)" [alt]="car.brand + ' ' + car.model" width="400" height="300" class="story-img">
          <div class="story-badge">Продано</div>
        </div>
        <div class="story-card__content">
          <div class="story-header">
            <h3 class="story-car">{{ car.brand }} {{ car.model }}</h3>
            <span class="story-year">{{ car.year }}</span>
          </div>
          <p class="story-text">
            Доставили за {{ 12 + (car.id % 7) }} дней. Клиент получил выгоду {{ (car.price * 0.07) | number:'1.0-0' }} ₽
            по сравнению с рынком РФ.
          </p>
          <div class="story-meta">
            <span class="story-price">{{ formatPrice(car.price) }}</span>
            <span class="story-location">{{ car.location || 'Москва' }}</span>
          </div>
        </div>
      </article>
    </div>
  </div>
</section>

<!-- CTA Section -->
<section class="cta" id="contact-form">
  <div class="container">
    <div class="cta__content">
      <h2 class="cta__title">Расскажите о вашем автомобиле мечты</h2>
      <p class="cta__description">
        Укажите три параметра — и в течение суток мы подготовим прозрачные предложения 
        с расчётом пошлин и доставки.
      </p>
      <a class="btn btn--primary btn--large" routerLink="/contacts">
        <i class="fas fa-paper-plane"></i>
        Оставить заявку
      </a>
    </div>
  </div>
</section>