<!-- Chat Widget -->
<div class="chat-widget" [class.open]="isOpen()">
  <!-- Chat Toggle Button -->
  <button 
    class="chat-toggle" 
    (click)="toggleChat()"
    [class.connected]="isConnected()"
    [class.has-messages]="messages().length > 0">
    <i class="fas fa-comments" *ngIf="!isOpen()"></i>
    <i class="fas fa-times" *ngIf="isOpen()"></i>
    <span class="chat-badge" *ngIf="messages().length > 0">{{ messages().length }}</span>
  </button>

  <!-- Chat Window -->
  <div class="chat-window" *ngIf="isOpen()">
    <!-- Chat Header -->
    <div class="chat-header">
      <div class="chat-title">
        <i class="fas fa-headset"></i>
        <span>Поддержка</span>
        <div class="connection-status" [class.connected]="isConnected()">
          <i class="fas fa-circle"></i>
          <span>{{ isConnected() ? 'Онлайн' : 'Подключение...' }}</span>
        </div>
      </div>
    </div>

    <!-- Chat Messages -->
    <div class="chat-messages">
      <div class="welcome-message" *ngIf="messages().length === 0">
        <div class="welcome-icon">
          <i class="fas fa-comments"></i>
        </div>
        <h3>Добро пожаловать!</h3>
        <p>Наша команда готова ответить на ваши вопросы о подборе автомобилей.</p>
        <div class="welcome-features">
          <div class="feature">
            <i class="fas fa-clock"></i>
            <span>Ответим в течение 5 минут</span>
          </div>
          <div class="feature">
            <i class="fas fa-shield-alt"></i>
            <span>Консультация бесплатно</span>
          </div>
          <div class="feature">
            <i class="fas fa-car"></i>
            <span>Подбор по вашим критериям</span>
          </div>
        </div>
      </div>

      <div 
        class="message" 
        *ngFor="let message of messages()"
        [class.client]="message.senderType === 'client'"
        [class.admin]="message.senderType === 'admin'">
        <div class="message-content">
          <div class="message-text">{{ message.message }}</div>
          <div class="message-time">{{ formatTime(message.createdAt) }}</div>
        </div>
      </div>

      <!-- Typing Indicator -->
      <div class="typing-indicator" *ngIf="isTyping()">
        <div class="typing-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <span class="typing-text">Администратор печатает...</span>
      </div>
    </div>

    <!-- Chat Input -->
    <div class="chat-input">
      <div class="input-group">
        <input 
          type="text" 
          [(ngModel)]="newMessage"
          (keyup.enter)="sendMessage()"
          (input)="onTyping()"
          placeholder="Напишите ваш вопрос..."
          class="message-input"
          [disabled]="!isConnected()">
        <button 
          class="send-button" 
          (click)="sendMessage()"
          [disabled]="!newMessage.trim() || !isConnected()">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>

    <!-- Client Info Form (показывается только при первом сообщении) -->
    <div class="client-info" *ngIf="messages().length === 0">
      <div class="info-title">
        <i class="fas fa-user"></i>
        <span>Расскажите о себе</span>
      </div>
      <div class="info-fields">
        <input 
          type="text" 
          [(ngModel)]="clientName"
          placeholder="Ваше имя"
          class="info-input">
        <input 
          type="email" 
          [(ngModel)]="clientEmail"
          placeholder="Email (необязательно)"
          class="info-input">
        <input 
          type="tel" 
          [(ngModel)]="clientPhone"
          placeholder="Телефон (необязательно)"
          class="info-input">
      </div>
    </div>
  </div>
</div>
